<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home | Inspire4Ever</title>
  <link rel="stylesheet" href="home.css" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDUefeJbHKIAs-l3zvFlGaas6VD63vv4kI",
      authDomain: "inspire4ever-c60ad.firebaseapp.com",
      projectId: "inspire4ever-c60ad",
      storageBucket: "inspire4ever-c60ad.appspot.com",
      messagingSenderId: "125014633127",
      appId: "1:125014633127:web:d29e4c37628ab637f40982",
      measurementId: "G-PNHJC0LRVQ",
      databaseURL: "https://inspire4ever-c60ad-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>
  <!-- Upload Button -->
  <div style="text-align: center; margin: 20px;">
    <button id="showFormBtn">üì§ Upload Video</button>
  </div>

  <!-- Upload Form -->
  <div class="upload-form" id="uploadForm" style="display: none;">
    <input id="title" placeholder="Video Title" />
    <input id="videoId" placeholder="YouTube Video ID" />
    <textarea id="script" placeholder="Video Script"></textarea>
    <input id="hashtags" placeholder="#hashtag1 #hashtag2" />
    <button onclick="uploadVideo()">Upload</button>
  </div>

  <div class="container">
    <h1>üé¨ Video Manager</h1>

    <!-- Dropdown -->
    <select id="video-select"></select>

    <!-- Thumbnail -->
    <div id="video-section">
      <img id="thumbnail" src="" alt="Video Thumbnail" class="video-thumb" style="max-width: 100%; height: auto;" />
    </div>

    <!-- Script -->
    <textarea id="scriptArea" rows="6" placeholder="Video script here..."></textarea>

    <!-- Hashtags -->
    <textarea id="hashtagArea" rows="3" placeholder="#hashtag1 #hashtag2 #hashtag3"></textarea>

    <button onclick="copyScript()">üìã Copy Script</button>
    <button onclick="deleteSelected()">üóëÔ∏è Delete</button>
  </div>

  <!-- JavaScript -->
  <script>
    const titleInput = document.getElementById("title");
    const videoIdInput = document.getElementById("videoId");
    const scriptInput = document.getElementById("script");
    const hashtagsInput = document.getElementById("hashtags");

    const dropdown = document.getElementById("video-select");
    const thumbnail = document.getElementById("thumbnail");
    const scriptArea = document.getElementById("scriptArea");
    const hashtagArea = document.getElementById("hashtagArea");

    let currentKey = null;

    document.getElementById("showFormBtn").addEventListener("click", () => {
      document.getElementById("uploadForm").style.display = "block";
      document.getElementById("showFormBtn").style.display = "none";
    });

    function uploadVideo() {
      const title = titleInput.value.trim();
      const videoId = videoIdInput.value.trim();
      const script = scriptInput.value.trim();
      const hashtags = hashtagsInput.value.trim();
      const date = new Date().toISOString();

      if (!title || !videoId || !script || !hashtags) {
        alert("‚ö†Ô∏è Please fill in all fields.");
        return;
      }

      const data = { title, videoId, script, hashtags, date };
      const key = db.ref("videos").push().key;

      db.ref("videos/" + key).set(data).then(() => {
        titleInput.value = "";
        videoIdInput.value = "";
        scriptInput.value = "";
        hashtagsInput.value = "";

        document.getElementById("uploadForm").style.display = "none";
        document.getElementById("showFormBtn").style.display = "block";

        loadVideos(videoId); // reload & auto-select uploaded one
      });
    }

    dropdown.addEventListener("change", function () {
      const selectedId = this.value;

      db.ref("videos").orderByChild("videoId").equalTo(selectedId).once("value", snap => {
        snap.forEach(child => {
          const video = child.val();
          currentKey = child.key;

          thumbnail.src = `https://img.youtube.com/vi/${video.videoId}/hqdefault.jpg`;
          scriptArea.value = video.script;
          hashtagArea.value = video.hashtags;
        });
      });
    });

    function deleteSelected() {
      if (!currentKey) {
        alert("‚ö†Ô∏è Please select a video to delete.");
        return;
      }

      const confirmDelete = confirm("Are you sure you want to delete this video?");
      if (!confirmDelete) return;

      db.ref("videos/" + currentKey).remove().then(() => {
        alert("‚úÖ Video deleted.");
        thumbnail.src = "";
        scriptArea.value = "";
        hashtagArea.value = "";
        dropdown.selectedIndex = 0;
        currentKey = null;
        loadVideos(); // reload list
      });
    }

    function copyScript() {
      const scriptText = `${scriptArea.value}\n\n${hashtagArea.value}`;
      navigator.clipboard.writeText(scriptText).then(() => {
        alert("üìã Copied to clipboard!");
      });
    }

    function loadVideos(selectedVideoId = null) {
      dropdown.innerHTML = ""; // clear previous
      db.ref("videos").once("value", snap => {
        let firstVideoId = null;

        snap.forEach((child, index) => {
          const video = child.val();
          const option = document.createElement("option");
          option.value = video.videoId;
          option.textContent = video.title;

          if (index === 0) firstVideoId = video.videoId;
          if (selectedVideoId && video.videoId === selectedVideoId) {
            option.selected = true;
          }

          dropdown.appendChild(option);
        });

        const toSelect = selectedVideoId || firstVideoId;
        if (toSelect) {
          dropdown.value = toSelect;
          dropdown.dispatchEvent(new Event("change"));
        }
      });
    }

    window.onload = loadVideos;
  </script>
</body>
</html>
