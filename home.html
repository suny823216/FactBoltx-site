<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FactsBoltx | Video Information</title>
  <link rel="stylesheet" href="home.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDUefeJbHKIAs-l3zvFlGaas6VD63vv4kI",
      authDomain: "inspire4ever-c60ad.firebaseapp.com",
      projectId: "inspire4ever-c60ad",
      storageBucket: "inspire4ever-c60ad.appspot.com",
      messagingSenderId: "125014633127",
      appId: "1:125014633127:web:d29e4c37628ab637f40982",
      measurementId: "G-PNHJC0LRVQ",
      databaseURL: "https://inspire4ever-c60ad-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>

  <div class="top-bar">
    <h2 id="subscriberCount">Subscribers: ...</h2>
 <!-- Admin Password Popup -->
<div id="passwordPopup" class="popup">
  <div class="popup-content">
    <h3>🔒 Admin Login</h3>
    <input type="password" id="popupPassword" placeholder="Enter Password">
    <div class="popup-buttons">
      <button onclick="handleAdminLogin()">Login</button>
      <button onclick="closePasswordPopup()">Cancel</button>
    </div>
  </div>
</div>

    <button id="showFormBtn" style="display:none"><i class="fa-solid fa-upload"></i> Upload Video</button>
  </div>

  <div class="upload-form" id="uploadForm" style="display:none;">
    <input id="title" placeholder="Video Title" />
    <input id="videoId" placeholder="YouTube Video ID" />
    <textarea id="script" placeholder="Video Script..."></textarea>
    <input id="hashtags" placeholder="#hashtags" />
    <button onclick="uploadVideo()">Upload</button>
  </div>

  <div class="container">
   

    <select id="videoDropdown" onchange="onVideoSelect()"></select>

    <a id="videoLink" href="#" target="_blank">
      <img id="thumbnail" src="" alt="Video Thumbnail" class="video-thumb" />
    </a>

    <div class="info-bar">
      <div id="videoStats">
        <span id="videoViews"><i class="fa-solid fa-eye"></i>  --</span>
        <span id="videoLikes"><i class="fa-solid fa-thumbs-up"></i>  --</span>
        <span id="videoDate"><i class="fa-solid fa-calendar"></i>  --</span>
      </div>
    </div>

<textarea id="scriptArea" rows="6" placeholder="Video Script..." readonly></textarea>
<textarea id="hashtagArea" rows="3" placeholder="#hashtags" readonly></textarea>


    <div class="button-group">
      <button onclick="copyScript()" class="btn blue"><i class="fa-solid fa-copy"></i> Copy Script</button>
      <button onclick="updateVideo()" id="updateBtn" class="btn green" disabled><i class="fa-solid fa-pen-nib"></i> Update</button>
      <button onclick="deleteSelected()" id="deleteBtn" class="btn red" disabled><i class="fa-solid fa-trash"></i> Delete</button>
    </div>
  </div>

  <script>
    const API_KEY = "AIzaSyAa5mJThKeXqIbcB_pBIE4jOlTw04Ej2fU";
    const ADMIN_CODE = "deepak95";
    let isAdmin = false;
    let currentKey = null;
    let allVideos = [];

    const titleInput = document.getElementById("title");
    const videoIdInput = document.getElementById("videoId");
    const scriptInput = document.getElementById("script");
    const hashtagsInput = document.getElementById("hashtags");
    const thumbnail = document.getElementById("thumbnail");
    const scriptArea = document.getElementById("scriptArea");
    const hashtagArea = document.getElementById("hashtagArea");
    const showFormBtn = document.getElementById("showFormBtn");
    const uploadForm = document.getElementById("uploadForm");
    const adminCodeBtn = document.getElementById("adminCodeBtn");
    const updateBtn = document.getElementById("updateBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const videoDropdown = document.getElementById("videoDropdown");
    const subscriberCount = document.getElementById("subscriberCount");
    const videoLink = document.getElementById("videoLink");
    const videoViews = document.getElementById("videoViews");
    const videoLikes = document.getElementById("videoLikes");
    const videoDate = document.getElementById("videoDate");

    function verifyAdminCode() {
  document.getElementById("popupPassword").value = "";
  document.getElementById("passwordPopup").style.display = "flex";
}

function closePasswordPopup() {
  document.getElementById("passwordPopup").style.display = "none";
}

function handleAdminLogin() {
  const inputPassword = document.getElementById("popupPassword").value;
  if (inputPassword === ADMIN_CODE) {
    isAdmin = true;
    localStorage.setItem("admin", "true");
    showAdminControls();
    closePasswordPopup();
    Swal.fire("✅ Access Granted", "Welcome Admin!", "success");
  } else {
    Swal.fire("❌ Access Denied", "Wrong password!", "error");
  }
}


    function showAdminControls() {
      showFormBtn.style.display = "inline-block";
      updateBtn.disabled = false;
      deleteBtn.disabled = false;
      adminCodeBtn.style.display = "none";
    }

    showFormBtn.addEventListener("click", () => {
      uploadForm.style.display = "block";
      showFormBtn.style.display = "none";
    });

    function uploadVideo() {
      if (!isAdmin) return alert("Admin access required");
      const title = titleInput.value.trim();
      const videoId = videoIdInput.value.trim();
      const script = scriptInput.value.trim();
      const hashtags = hashtagsInput.value.trim();
      if (!title || !videoId || !script || !hashtags) {
        return alert("⚠️ Please fill in all fields.");
      }
      const data = { title, videoId, script, hashtags, date: new Date().toISOString() };
      const key = db.ref("videos").push().key;
      db.ref("videos/" + key).set(data).then(() => {
        resetUploadForm();
        loadVideos(videoId);
      });
    }

    function updateVideo() {
      if (!isAdmin) return alert("Admin access required");
      if (!currentKey) return alert("⚠️ Select a video first.");
      const updatedData = {
        title: titleInput.value.trim(),
        videoId: videoIdInput.value.trim(),
        script: scriptInput.value.trim(),
        hashtags: hashtagsInput.value.trim(),
        date: new Date().toISOString()
      };
      db.ref("videos/" + currentKey).update(updatedData).then(() => {
        alert("✅ Video updated.");
        loadVideos(updatedData.videoId);
      });
    }

    function deleteSelected() {
      if (!isAdmin) return alert("Admin access required");
      if (!currentKey) return alert("⚠️ Select a video first.");
      if (!confirm("Are you sure you want to delete this video?")) return;
      db.ref("videos/" + currentKey).remove().then(() => {
        alert("✅ Video deleted.");
        resetDisplay();
        loadVideos();
      });
    }

    function copyScript() {
      const text = `${scriptArea.value}\n\n${hashtagArea.value}`;
      navigator.clipboard.writeText(text).then(() => {
        alert("📋 Copied to clipboard!");
      });
    }

    function resetUploadForm() {
      titleInput.value = "";
      videoIdInput.value = "";
      scriptInput.value = "";
      hashtagsInput.value = "";
      uploadForm.style.display = "none";
      showFormBtn.style.display = "inline-block";
    }

    function resetDisplay() {
      thumbnail.src = "";
      scriptArea.value = "";
      hashtagArea.value = "";
      currentKey = null;
      videoDropdown.selectedIndex = 0;
    }

    async function loadYouTubeData(videoId) {
      try {
        const videoRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoId}&key=${API_KEY}`);
        const videoData = await videoRes.json();
        const video = videoData.items[0];
        if (video) {
         videoViews.innerHTML = `<i class="fa-solid fa-eye"></i> : ${video.statistics.viewCount}`;
videoLikes.innerHTML = `<i class="fa-solid fa-thumbs-up"></i> : ${video.statistics.likeCount}`;
videoDate.innerHTML = `<i class="fa-solid fa-calendar-days"></i> : ${video.snippet.publishedAt.split("T")[0]}`;

          const channelId = video.snippet.channelId;
          const channelRes = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${API_KEY}`);
          const channelData = await channelRes.json();
          const channel = channelData.items[0];
          if (channel) {
            subscriberCount.textContent = `Subscribers: ${channel.statistics.subscriberCount}`;
          }
        }
      } catch (err) {
       console.error("YouTube API Error", err);
videoViews.innerHTML = '<i class="fa-solid fa-eye"></i> : --';
videoLikes.innerHTML = '<i class="fa-solid fa-thumbs-up"></i> : --';
videoDate.innerHTML = '<i class="fa-solid fa-calendar-days"></i> : --';
subscriberCount.innerHTML = '<i class="fa-solid fa-user-group"></i> Subscribers: --';

      }
    }

    function loadVideos(selectedId = null) {
      videoDropdown.innerHTML = "";
      db.ref("videos").once("value", snap => {
        allVideos = [];
        snap.forEach(child => {
          const video = child.val();
          video.key = child.key;
          allVideos.push(video);
        });
        allVideos.sort((a, b) => new Date(b.date) - new Date(a.date));
        allVideos.forEach(video => {
          const opt = document.createElement("option");
          opt.value = video.key;
          opt.textContent = video.title;
          videoDropdown.appendChild(opt);
        });
        if (selectedId) {
          const match = allVideos.find(v => v.videoId === selectedId);
          if (match) {
            videoDropdown.value = match.key;
            populateDetails(match);
          }
        } else if (allVideos.length > 0) {
          videoDropdown.value = allVideos[0].key;
          populateDetails(allVideos[0]);
        }
      });
    }

    function onVideoSelect() {
      const key = videoDropdown.value;
      const video = allVideos.find(v => v.key === key);
      if (!video) return;
      currentKey = key;
      populateDetails(video);
    }

    function populateDetails(video) {
      const vid = video.videoId;
      thumbnail.src = `https://img.youtube.com/vi/${vid}/hqdefault.jpg`;
      videoLink.href = `https://www.youtube.com/watch?v=${vid}`;
      scriptArea.value = video.script;
      hashtagArea.value = video.hashtags;
      titleInput.value = video.title;
      videoIdInput.value = video.videoId;
      scriptInput.value = video.script;
      hashtagsInput.value = video.hashtags;
      loadYouTubeData(vid);
    }

    window.onload = () => {
      loadVideos();
      if (localStorage.getItem("admin") === "true") {
        isAdmin = true;
        showAdminControls();
      }
    };
  </script>
</body>
</html>
