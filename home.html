<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FactsBoltx | Video Information</title>
  <link rel="stylesheet" href="home.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDUefeJbHKIAs-l3zvFlGaas6VD63vv4kI",
      authDomain: "inspire4ever-c60ad.firebaseapp.com",
      projectId: "inspire4ever-c60ad",
      storageBucket: "inspire4ever-c60ad.appspot.com",
      messagingSenderId: "125014633127",
      appId: "1:125014633127:web:d29e4c37628ab637f40982",
      measurementId: "G-PNHJC0LRVQ",
      databaseURL: "https://inspire4ever-c60ad-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>

   <div class="top-bar">
    <h2 id="subscriberCount"><i class="fa-solid fa-people-group"></i> Subscribers: ...</h2>
    
    <button onclick="verifyAdminCode()" id="adminCodeBtn" class="upload-btn locked">
  <i class="fa-solid fa-user-tie"></i> Admin Login
  <i class="fa-solid fa-lock lock-icon"></i>
</button>

    <button id="showFormBtn"  style="display:none"class="upload-btn"><i class="fa-solid fa-upload" ></i> Upload Video</button>
   <a href="space.html" class="btn puzzle-btn">
  <i class="fa-solid fa-robot"></i> AI GENERATOR 
</a>


<a href="chart.html" class="btn puzzle-btn">
  <i class="fa-solid fa-chart-simple"></i> View Analytics
</a>

<div id="coinBox" style="
  display: inline-flex;
  align-items: center;
  background-color: #2c2c2c;
  color: #ffd700;
  border-radius: 20px;
  padding: 6px 14px;
  font-size: 17px;
  font-weight: bold;
  font-family: 'JetBrains Mono', monospace;
  box-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
  margin: 10px;
">
  <i class="fa-solid fa-coins" style="margin-right: 8px;"></i>
  <span id="coinCount">0</span> 
</div>


  </div>

 <div id="uploadContainer" style="display: none;">
  <div class="upload-form">
    <input id="title" placeholder="Video Title" />
    <input id="videoId" placeholder="YouTube Video ID" />
    <textarea id="script" placeholder="Video Script..."></textarea>
    <input id="hashtags" placeholder="#hashtags" />
  
    <div class="button-group">
      <button onclick="uploadVideo()">Upload</button>
      <button type="button" onclick="hideUploadForm()" class="btn red">Cancel</button>
    </div>
  </div>
</div>



  <div class="container">
   

    <div class="custom-dropdown">
  <div class="selected" onclick="toggleDropdown()">üé¨ Select Video</div>
  <div class="options" id="dropdownOptions"></div>
</div>


    <a id="videoLink" href="#" target="_blank">
      <img id="thumbnail" src="" alt="Video Thumbnail" class="video-thumb" />
    </a>
<div class="watch-now-wrapper">
  <a id="watchNowBtn" class="btn blue" target="_blank">üé¨ Watch Now on YouTube</a>
</div>

    <div class="info-bar">
      <div id="videoStats">
        <span id="videoViews"><i class="fa-solid fa-eye"></i>  --</span>
        <span id="videoLikes"><i class="fa-solid fa-thumbs-up"></i>  --</span>
        <span id="videoDate"><i class="fa-solid fa-calendar"></i>  --</span>
      </div>
    </div>

<textarea id="scriptArea" rows="6" placeholder="Video Script..." readonly></textarea>
<textarea id="hashtagArea" rows="3" placeholder="#hashtags" readonly></textarea>

<div class="share-buttons">
  <a href="#" id="whatsappShare" target="_blank"><i class="fa-brands fa-whatsapp"></i> Share</a>
  <a href="#" id="facebookShare" target="_blank"><i class="fa-brands fa-facebook"></i> Share</a>
  <a href="#" id="twitterShare" target="_blank"><i class="fa-brands fa-twitter"></i> Share</a>
</div>
<div style="height: 20px;"></div>
    <div class="button-group">
      <button onclick="copyScript()" class="btn blue"><i class="fa-solid fa-copy"></i> Copy Script</button>
      <button onclick="updateVideo()" id="updateBtn" class="btn green" disabled><i class="fa-solid fa-pen-nib"></i> Update</button>
      <button onclick="deleteSelected()" id="deleteBtn" class="btn red" disabled><i class="fa-solid fa-trash"></i> Delete</button>
    </div>
  </div>
  
<script>
  // Initialize coins from localStorage
  let coins = parseInt(localStorage.getItem("userCoins") || "0");
  document.addEventListener("DOMContentLoaded", () => {
    updateCoinUI();
  });

  function updateCoinUI() {
    document.getElementById("coinCount").textContent = coins;
  }

  function addCoins(amount) {
    coins += amount;
    localStorage.setItem("userCoins", coins);
    updateCoinUI();
    Swal.fire({
      icon: "success",
      title: `üéâ You've earned ${amount} coins!`,
      showConfirmButton: false,
      timer: 2000
    });
  }
</script>
<script>
  document.getElementById("whatsappShare").addEventListener("click", () => {
    addCoins(20);
  });

  document.getElementById("facebookShare").addEventListener("click", () => {
    addCoins(20);
  });

  document.getElementById("twitterShare").addEventListener("click", () => {
    addCoins(20);
  });
</script>

  <script>
    const API_KEY = "AIzaSyAa5mJThKeXqIbcB_pBIE4jOlTw04Ej2fU";
    const ADMIN_CODE = "deepak95";
    let isAdmin = false;
    let currentKey = null;
    let allVideos = [];

    const titleInput = document.getElementById("title");
    const videoIdInput = document.getElementById("videoId");
    const scriptInput = document.getElementById("script");
    const hashtagsInput = document.getElementById("hashtags");
    const thumbnail = document.getElementById("thumbnail");
    const scriptArea = document.getElementById("scriptArea");
    const hashtagArea = document.getElementById("hashtagArea");
    const showFormBtn = document.getElementById("showFormBtn");
   const uploadContainer = document.getElementById("uploadContainer");

    const adminCodeBtn = document.getElementById("adminCodeBtn");
    const updateBtn = document.getElementById("updateBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const videoDropdown = document.getElementById("videoDropdown");
    const subscriberCount = document.getElementById("subscriberCount");
    const videoLink = document.getElementById("videoLink");
    const videoViews = document.getElementById("videoViews");
    const videoLikes = document.getElementById("videoLikes");
    const videoDate = document.getElementById("videoDate");

   function verifyAdminCode() {
  Swal.fire({
    title: 'üîê Admin Access',
    html: `
      <p style="margin-bottom: 10px;">Choose how you want to access admin mode:</p>
      <button id="loginBtn" class="swal2-confirm swal2-styled" style="background-color:#3b82f6; margin-bottom: 10px; width: 100%;">
        üîë Login with Password
      </button><br>
      <button id="buyBtn" class="swal2-confirm swal2-styled" style="background-color:#22c55e; width: 100%;" ${coins < 1000 ? "disabled" : ""}>
         Purchase Admin Mode(1000 coins)
      </button>
    `,
    showConfirmButton: false,
    background: '#1e1e1e',
    color: '#ffffff',
    didOpen: () => {
      const loginBtn = document.getElementById('loginBtn');
      const buyBtn = document.getElementById('buyBtn');

      // üîë Login with Password
      loginBtn.addEventListener('click', () => {
        Swal.close();
        showPasswordPrompt();
      });

      // ü™ô Buy Admin Access
      buyBtn.addEventListener('click', () => {
        if (coins >= 1000) {
          coins -= 1000;
          localStorage.setItem("userCoins", coins);
          updateCoinUI();
          isAdmin = true;
          localStorage.setItem("admin", "true");
          showAdminControls();
          Swal.fire({
            title: '‚úÖ Success!',
            text: 'You are now an admin.',
            icon: 'success',
            background: '#1e1e1e',
            color: '#ffffff',
            width: "280px"
          });
        }
      });
    }
  });
}
function showPasswordPrompt() {
  Swal.fire({
    title: 'üîê Enter Admin Password',
    width: '280px',
    background: '#1e1e1e',
    color: '#ffffff',
    input: 'password',
    inputLabel: 'Admin Password',
    inputPlaceholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢',
    inputAttributes: {
      autocapitalize: 'off',
      autocorrect: 'off'
    },
    showCancelButton: true,
    confirmButtonText: 'Login',
    preConfirm: (code) => {
      if (!code) {
        Swal.showValidationMessage('‚ö†Ô∏è Please enter password');
        return false;
      }
      return code;
    }
  }).then(result => {
    if (result.isConfirmed) {
      const code = result.value;
      if (code === ADMIN_CODE) {
        isAdmin = true;
        localStorage.setItem("admin", "true");
        showAdminControls();
        Swal.fire({
          title: '‚úÖ Success!',
          text: 'Admin access granted.',
          icon: 'success',
          background: '#1e1e1e',
          color: '#ffffff',
          width: '280px'
        });
      } else {
        Swal.fire({
          title: '‚ùå Failed',
          text: 'Invalid admin password.',
          icon: 'error',
          background: '#1e1e1e',
          color: '#ffffff',
          width: '280px'
        });
      }
    }
  });
}


function toggleDropdown() {
  const selected = document.querySelector(".selected");
  const options = document.getElementById("dropdownOptions");

  if (options.style.display === "block") {
    options.style.display = "none";
    selected.classList.remove("open");
  } else {
    options.style.display = "block";
    selected.classList.add("open");
  }
}
function updateShareLinks(videoId, title) {
  const url = `https://www.youtube.com/watch?v=${videoId}`;
  document.getElementById("whatsappShare").href = `https://wa.me/?text=${encodeURIComponent(title + " üîó " + url)}`;
  document.getElementById("facebookShare").href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
  document.getElementById("twitterShare").href = `https://twitter.com/intent/tweet?url=${url}&text=${encodeURIComponent(title)}`;
  
}


function selectVideo(video, key, shouldToggle = true) {
  document.querySelector(".selected").textContent = "üé¨ " + video.title;

  if (shouldToggle) {
    toggleDropdown();  // ‚úÖ ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§§‡§≠‡•Ä toggle ‡§π‡•ã‡§ó‡§æ ‡§ú‡§¨ ‡§ö‡§æ‡§π‡§ø‡§è
  } else {
    // üö´ dropdown ‡§¨‡§Ç‡§¶ ‡§ï‡§∞ ‡§¶‡•ã ‡§Ö‡§ó‡§∞ ‡§ü‡•â‡§ó‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§®‡§æ ‡§π‡•à
    const options = document.getElementById("dropdownOptions");
    options.style.display = "none";
    document.querySelector(".selected").classList.remove("open");
  }

  currentKey = key;
  populateDetails(video);
}


// This replaces <select> render
function renderDropdown(videos) {
  const optionsContainer = document.getElementById("dropdownOptions");
  optionsContainer.innerHTML = "";
  videos.forEach(video => {
    const div = document.createElement("div");
    div.textContent = video.title;
    div.onclick = () => selectVideo(video, video.key);
    optionsContainer.appendChild(div);
  });
}


    function showAdminControls() {
      showFormBtn.style.display = "inline-block";
      updateBtn.disabled = false;
      deleteBtn.disabled = false;
      adminCodeBtn.style.display = "none";
    }

    showFormBtn.addEventListener("click", () => {
  uploadContainer.style.display = "block";
  showFormBtn.style.display = "none";
});

function uploadVideo() {
  const title = titleInput.value.trim();
  const videoId = videoIdInput.value.trim();
  const script = scriptInput.value.trim();
  const hashtags = hashtagsInput.value.trim();

  if (!title || !videoId || !script || !hashtags) {
    Swal.fire({
      icon: "warning",
      title: "‚ö†Ô∏è Missing Information",
      text: "Please fill in all the fields before uploading.",
      background: "#1e1e1e",
      color: "#ffffff",
       width: "280px"  // ‚¨ÖÔ∏è Popup width ‡§õ‡•ã‡§ü‡§æ ‡§ï‡§ø‡§Ø‡§æ
    });
    return;
  }

  const newVideo = {
    title,
    videoId,
    script,
    hashtags,
    date: new Date().toISOString()
  };

  db.ref("videos").push(newVideo).then(() => {
    Swal.fire({
      icon: "success",
      title: "‚úÖ Uploaded!",
      text: "Video has been successfully uploaded.",
      width: "280px" ,
      background: "#1e1e1e",
      color: "#ffffff"
    });
    loadVideos(); // Refresh list
    clearForm();  // Clear form fields
  });
}

function updateVideo() {
  if (!isAdmin) {
    Swal.fire({
      icon: "error",
      title: "Access Denied",
      text: "Admin access required to update.",
      background: "#1e1e1e",
      width: "280px" ,
      color: "#ffffff"
    });
    return;
  }

  const updatedData = {
    title: titleInput.value.trim(),
    videoId: videoIdInput.value.trim(),
    script: scriptInput.value.trim(),
    hashtags: hashtagsInput.value.trim(),
    date: new Date().toISOString()
  };

  db.ref("videos/" + currentKey).update(updatedData).then(() => {
    Swal.fire({
      icon: "success",
      title: "‚úÖ Updated",
      text: "Video has been successfully updated!",
      background: "#1e1e1e",
      color: "#ffffff",
      width: "280px" 
    });
    loadVideos(updatedData.videoId);
  });
}


   function deleteSelected() {
  if (!currentKey) {
    Swal.fire({
      icon: "warning",
      title: "‚ö†Ô∏è No Video Selected",
      text: "Please select a video to delete.",
      background: "#1e1e1e",
      color: "#ffffff",
      width: "280px" 
    });
    return;
  }

  Swal.fire({
    title: "‚ö†Ô∏è Are you sure?",
    text: "This action cannot be undone.",
    icon: "warning",
    width: "280px" ,
    showCancelButton: true,
    confirmButtonColor: "#e50914",
    cancelButtonColor: "#555",
    confirmButtonText: "Yes, delete it!",
    background: "#1e1e1e",
    color: "#ffffff"
  }).then((result) => {
    if (result.isConfirmed) {
      db.ref("videos/" + currentKey).remove().then(() => {
        Swal.fire({
          title: "‚úÖ Deleted",
          text: "Video has been removed.",
          icon: "success",
          background: "#1e1e1e",
          width: "280px" ,
          color: "#ffffff"
        });
        resetDisplay();
        loadVideos();
      }).catch((error) => {
        Swal.fire({
          icon: "error",
          title: "‚ùå Deletion Failed",
          text: error.message,
          background: "#1e1e1e",
          width: "280px" ,
          color: "#ffffff"
        });
      });
    }
  });
}


   function copyScript() {
  const text = scriptArea.value; // ‚úÖ ‡§∏‡§ø‡§∞‡•ç‡§´ script ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à
  
  navigator.clipboard.writeText(text).then(() => {
    Swal.fire({
      icon: "success",
      title: "üìã Script Copied!",
      text: "Only the script has been copied to clipboard.",
      background: "#1e1e1e",
      color: "#ffffff",
      timer: 1500,
      width: "280px" ,
      showConfirmButton: false
    });
  }).catch((err) => {
    Swal.fire({
      icon: "error",
      title: "‚ùå Copy Failed",
      text: "Could not copy the script.",
      background: "#1e1e1e",
      width: "280px" ,
      color: "#ffffff"
    });
  });
}



    function resetUploadForm() {
      titleInput.value = "";
      videoIdInput.value = "";
      scriptInput.value = "";
      hashtagsInput.value = "";
      uploadContainer.style.display = "none";
  showFormBtn.style.display = "inline-block";
    }
function hideUploadForm() {
  uploadContainer.style.display = "none";
  showFormBtn.style.display = "inline-block";
  // Optional: fields ‡§≠‡•Ä ‡§∏‡§æ‡§´ ‡§ï‡§∞ ‡§¶‡•ã
  resetUploadForm();
}
   function resetDisplay() {
  thumbnail.src = "";
  scriptArea.value = "";
  hashtagArea.value = "";
  currentKey = null;

  // üé¨ Custom dropdown ‡§ï‡•ã "Select Video" ‡§™‡§∞ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•ã
  document.querySelector(".selected").textContent = "üé¨ Select Video";

  // ‡§¨‡§æ‡§ï‡•Ä ‡§∏‡§¨ ‡§ï‡•ã ‡§≠‡•Ä ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•ã
  videoLink.href = "#";
  videoViews.innerHTML = '<i class="fa-solid fa-eye"></i>  --';
  videoLikes.innerHTML = '<i class="fa-solid fa-thumbs-up"></i>  --';
  videoDate.innerHTML = '<i class="fa-solid fa-calendar-days"></i>  --';
  subscriberCount.innerHTML = '<i class="fa-solid fa-people-group"></i> Subscribers: --';
}


  async function loadYouTubeData(videoId) {
  showLoader(); // üëà Start loader
  try {
    const videoRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoId}&key=${API_KEY}`);
    const videoData = await videoRes.json();
    const video = videoData.items[0];

    if (video) {
      videoViews.innerHTML = `<i class="fa-solid fa-eye"></i> : ${video.statistics.viewCount}`;
      videoLikes.innerHTML = `<i class="fa-solid fa-thumbs-up"></i> : ${video.statistics.likeCount}`;
      videoDate.innerHTML = `<i class="fa-solid fa-calendar-days"></i> : ${video.snippet.publishedAt.split("T")[0]}`;

      const channelId = video.snippet.channelId;
      const channelRes = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${API_KEY}`);
      const channelData = await channelRes.json();
      const channel = channelData.items[0];
      if (channel) {
  subscriberCount.innerHTML = `<i class="fa-solid fa-people-group"></i> Subscribers: ${channel.statistics.subscriberCount}`;
}

    }
  } catch (err) {
    console.error("YouTube API Error", err);
    videoViews.innerHTML = '<i class="fa-solid fa-eye"></i> : --';
    videoLikes.innerHTML = '<i class="fa-solid fa-thumbs-up"></i> : --';
    videoDate.innerHTML = '<i class="fa-solid fa-calendar-days"></i> : --';
    subscriberCount.innerHTML = '<i class="fa-solid fa-user-group"></i> Subscribers: --';
  }
  hideLoader(); // üëà End loader
}


  function loadVideos(selectedId = null) {
  showLoader();
  db.ref("videos").once("value", snap => {
    allVideos = [];
    snap.forEach(child => {
      const video = child.val();
      video.key = child.key;
      allVideos.push(video);
    });

    allVideos.sort((a, b) => new Date(b.date) - new Date(a.date));
    renderDropdown(allVideos); // üëà custom dropdown render

    if (allVideos.length > 0) {
      const firstVideo = allVideos[0];
      selectVideo(firstVideo, firstVideo.key, false); // üö´ dropdown ‡§ï‡•ã ‡§®‡§æ ‡§ñ‡•ã‡§≤‡•ã

    }

    hideLoader();
  });
}


    function onVideoSelect() {
      const key = videoDropdown.value;
      const video = allVideos.find(v => v.key === key);
      if (!video) return;
      currentKey = key;
      populateDetails(video);
    }

   function populateDetails(video) {
  const vid = video.videoId;
  updateShareLinks(video.videoId, video.title);

  currentKey = video.key; // üëà ‡§Ø‡§π ‡§ú‡•ã‡§°‡§º‡•ã: thumbnail ‡§µ‡§æ‡§≤‡•Ä ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•Ä key set ‡§ï‡§∞‡•ã

  thumbnail.src = `https://img.youtube.com/vi/${vid}/hqdefault.jpg`;
  videoLink.href = `https://www.youtube.com/watch?v=${vid}`;
  scriptArea.value = video.script;
  hashtagArea.value = video.hashtags;
  titleInput.value = video.title;
  videoIdInput.value = video.videoId;
  scriptInput.value = video.script;
  hashtagsInput.value = video.hashtags;
    document.getElementById("watchNowBtn").href = `https://www.youtube.com/watch?v=${vid}`;
  loadYouTubeData(vid);
}
function showLoader() {
  document.getElementById("loadingOverlay").style.display = "flex";
  document.body.classList.add("loading");
}

function hideLoader() {
  document.getElementById("loadingOverlay").style.display = "none";
  document.body.classList.remove("loading");
}

    window.onload = () => {
      loadVideos();
      if (localStorage.getItem("admin") === "true") {
        isAdmin = true;
        showAdminControls();
      }
    };
  </script>
</body>
<div id="loadingOverlay">
  <div class="loader"></div>
</div>

</html>
